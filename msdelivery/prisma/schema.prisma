// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DeliveryPersonStatus {
  AVAILABLE
  BUSY
  OFFLINE
  ON_BREAK
}

enum VehicleType {
  BIKE
  MOTORCYCLE
  CAR
  SCOOTER
  WALKING
}

enum DeliveryStatus {
  PENDING
  ASSIGNED
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  CANCELLED
  FAILED
}

model DeliveryPerson {
  id              Int                  @id @default(autoincrement())
  name            String
  email           String               @unique
  phone           String               @unique
  cpf             String               @unique
  vehicleType     VehicleType
  licensePlate    String?              @unique
  status          DeliveryPersonStatus @default(OFFLINE)
  rating          Float                @default(5.0)
  totalDeliveries Int                  @default(0)

  currentLatitude    Float?
  currentLongitude   Float?
  lastLocationUpdate DateTime?

  isActive Boolean  @default(true)
  joinedAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  deliveries Delivery[]

  @@index([status])
  @@index([email])
  @@index([phone])
  @@index([licensePlate])
  @@index([currentLatitude, currentLongitude])
  @@map("delivery_persons")
}

model Delivery {
  id               Int            @id @default(autoincrement())
  orderId          Int            @unique
  deliveryPersonId Int?
  deliveryPerson   DeliveryPerson? @relation(fields: [deliveryPersonId], references: [id])
  
  status DeliveryStatus @default(PENDING)
  
  customerLatitude  Float
  customerLongitude Float
  customerAddress   String
  
  assignedAt   DateTime?
  pickedUpAt   DateTime?
  deliveredAt  DateTime?
  cancelledAt  DateTime?
  
  estimatedDeliveryTime Int?
  actualDeliveryTime    Int?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([orderId])
  @@index([deliveryPersonId])
  @@index([status])
  @@map("deliveries")
}
